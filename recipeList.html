<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>CMSC434 Phase 1.2</title>
    <link rel="stylesheet" href="recipeList.css" />
</head>

<body>
    <div id="header">
        <span style="vertical-align: middle">Recipes</span>
    </div>

    <button onclick="addItemLink()" class="addRecipe">+ Add Recipe</button>
    <div id="pop-up">
        <div id="pop-up-prompt">Add New Recipe</div>
        <label class='element' for="name"><b>Recipe Name</b></label>
        <input class='element' id="name" type="text" name="name" placeholder="Enter Name">
        <label class='element' for="description"><b>Recipe Description</b></label>
        <textarea class='element' id="description" name="description" rows="4" cols="50"
                placeholder="Enter Description"></textarea>

            <!-- Add a new input field for ingredients with quantities -->
        <label class='element' for="ingredients"><b>Ingredients (Ingredient: Quantity, Ingredient: Quantity)</label>
        <input class='element' id="ingredients" type="text" name="ingredients"
            placeholder="Enter Ingredients and Quantities (e.g., Ingredient1: Quantity1, Ingredient2: Quantity2)">
        <div id="pop-up-buttons">
            <button type="button" class="p-buttons" onclick="closeAddItemMenu()">Exit</button>
            <button type="button" class="p-buttons" onclick="createRecipe()">Add Recipe</button>
        </div>
    </div>

    <div id="recipeContainer"></div>

    <div class="navbar">
        <a href="kitchenInventory.html"><img src="fridge.png" width="150" height="150"></a>
        <a href="shopping.html"><img src="ecommerce_cart.png" width="150" height="150"></a>
        <a href="recipeList.html"><img src="chef.png" width="150" height="150"></a>
        <a href="profiles.html"><img src="community.png" width="150" height="150"></a>
    </div>

    <script>
         function addItemLink() {
            let popUp = document.getElementById("pop-up");
            popUp.style.visibility = "visible";
        }

        function closeAddItemMenu() {
            let popUp = document.getElementById("pop-up");
            popUp.style.visibility = "hidden";
        }

        function createRecipe() {
            var name = document.getElementById("name").value;
            var description = document.getElementById("description").value;
            var ingredientsInput = document.getElementById("ingredients").value;

            // Check if any of the required fields are empty
            if (!name || !description || !ingredientsInput) {
                alert("Please fill in all the required fields.");
                return;
            }

            // Check if ingredients input has the correct format
            var ingredientsList = ingredientsInput.split(',');
            for (var i = 0; i < ingredientsList.length; i++) {
                if (ingredientsList[i].trim().split(':').length !== 2) {
                    alert("Ingredients format is incorrect. Please use 'Ingredient: Quantity' format.");
                    return;
                }
            }

            // If all checks pass, proceed with creating the recipe
            var data = localStorage.getItem('recipeList');
            var list = new Set();
            if (data == null) {
                localStorage.setItem("recipeList", JSON.stringify([]));
            } else {
                list = new Set(JSON.parse(data));
            }

            var recipeContainer = document.createElement("div");
            recipeContainer.id = "recipe";

            var descriptionContainer = document.createElement("div");
            descriptionContainer.className = "description-text";

            var descriptionTextContainer = document.createElement("div");
            descriptionTextContainer.className = "recipe-text user-input";
            descriptionTextContainer.textContent = description;

            var ingr = document.createElement("ul");
            ingr.setAttribute("id", "ing");

            for (var i = 0; i < ingredientsList.length; i++) {
                var ingredientInfo = ingredientsList[i].split(':');
                var ingredientName = ingredientInfo[0].trim();
                var ingredientQuantity = ingredientInfo[1].trim();

                var li = document.createElement('li');
                li.appendChild(document.createTextNode(ingredientName + ': ' + ingredientQuantity));
                ingr.appendChild(li);
            }

            descriptionContainer.append(ingr);
            localStorage.setItem(name + "_ingredients", JSON.stringify(ingredientsList));

            var textContainer = document.createElement("div");
            textContainer.className = "text-container";

            var recipeText = document.createElement("div");
            recipeText.className = "recipe-text";
            recipeText.textContent = name;
            list.add(name);
            localStorage.setItem("recipeList", JSON.stringify(Array.from(list)));

            var span = document.createElement("SPAN");
            var txt = document.createTextNode("\u00D7");
            span.className = "close";
            span.appendChild(txt);
            span.onclick = function () {
                var listItem = this.parentElement.parentElement.parentElement;
                list.delete(name);
                localStorage.setItem("recipeList", JSON.stringify(Array.from(list)));
                localStorage.removeItem(name + "_ingredients");
                listItem.remove();
            };
            recipeText.appendChild(span);

            descriptionContainer.append(descriptionTextContainer);
            textContainer.appendChild(recipeText);
            recipeContainer.appendChild(textContainer);
            recipeContainer.appendChild(descriptionContainer);
            recipeContainer.addEventListener("click", () => {
                textContainer.classList.toggle("remove");
                descriptionContainer.classList.toggle("show");
            });
            document.getElementById("recipeContainer").appendChild(recipeContainer);
            document.getElementById("description").value = "";
            document.getElementById("name").value = "";
            document.getElementById("ingredients").value = "";
            closeAddItemMenu();
        }
    </script>
</body>

</html>
